## ðŸ“‹ Description

### What changed?
- Implemented build-time API fetching to prerender ProductList, ServiceList, and LocationList schemas into static HTML
- Fixed critical Schema.org validator detection issue where ProductList schemas weren't visible in static HTML
- Consolidated all prerender API fetching into single Promise.all call
- Fixed LocationList homepage logic to match actual display (primary location only)
- Documented comprehensive static fallback removal strategy for future API migrations

### Why?
**Problem:** Schema.org validators couldn't detect ProductList schemas on homepage and RoCafÃ© page despite successful client-side rendering. Root cause was timing/hydration issue - validators check static HTML before JavaScript executes, but menu data comes from API after ~500ms delay.

**Solution:** Fetch menu data at build time and inject ProductList schemas into static HTML. Proactively extended pattern to Services and Locations APIs for future scalability.

**Impact:**
- Homepage: 4 featured Product schemas now in static HTML âœ…
- RoCafÃ©: 75 Product schemas now in static HTML âœ…
- Zero runtime performance impact (schemas already in DOM)
- Build time: +2-3 seconds for API fetch (acceptable)
- Pattern established for all future API-driven schemas

## ðŸ·ï¸ Type of Change
- [x] âœ¨ Feature (prerendered schemas, consolidated API fetching)
- [x] ðŸ› Bug fix (ProductList detection, LocationList homepage mismatch)
- [x] ðŸ“š Documentation (comprehensive analysis, fallback removal strategy)
- [x] âš¡ Performance (parallel API fetching, optimized build process)

## ðŸ”— Related Issues
- Fixes ProductList schema detection issue identified in Schema.org validator testing
- Addresses user feedback on LocationList homepage/display mismatch
- Implements systematic approach to API-driven schema prerendering

## ðŸ“ Changes Made

### Added
- `fetchMenuData()` in prerender.js - Fetches menu API at build time
- `fetchServicesData()` in prerender.js - Fetches services API at build time (future-proof)
- `fetchLocationsData()` in prerender.js - Fetches locations API at build time (future-proof)
- `buildProductListSchema()` in prerender.js - Generates ProductList schemas from menu items
- Parallel API fetching with Promise.all for maximum build efficiency
- Route-specific schema injection (homepage featured items, RoCafÃ© all items)
- Graceful fallback: empty arrays if APIs unavailable (client-side React handles static fallback)
- Comprehensive documentation: Static fallback removal strategy (3 phases)
- Deployment safety: Branch checks, staging/production separation

### Changed
- `buildStructuredData()` now accepts route context and API data
- Homepage LocationList schema: Now includes only primary location (was: all locations)
- Locations page LocationList schema: Clarified that all active locations intentional for SEO
- Prerender script now fetches all APIs in parallel at start of build
- Master plan updated with Step 3.1: Consolidated API Fetching & LocationList Fix
- API migration readiness completely rewritten with field specifications and enumerations
- StandardizedItem.jsx now uses ServicesContext instead of static import

### Removed
- N/A (no breaking changes)

### Fixed
- ProductList schemas not detected by Schema.org validator in static HTML
- LocationList homepage schema included all locations but display showed only primary (mismatch)
- Console.info eslint errors in diagnostic logging
- GitHub Pages base path configuration for staging deployment

## âœ… Testing Checklist

### Automated Tests
- [x] `npm run lint` passes (0 errors)
- [x] `npm run build` succeeds without errors (10.00s)
- [x] Prerender script successfully fetches APIs and generates HTML

### Manual Testing (Static HTML Verification)
- [x] Homepage contains 1 ItemList schema (ProductList)
- [x] Homepage contains 4 Product schemas (featured items)
- [x] RoCafÃ© page contains 1 ItemList schema (ProductList)
- [x] RoCafÃ© page contains 75 Product schemas (all menu items)
- [x] Build output shows API fetch logs: "âœ“ Fetched 75 menu items (4 featured)"
- [x] Graceful fallback works when APIs return 404 (Services/Locations)
- [x] No console errors during build process
- [x] Static HTML validates with grep commands

### Schema Validation
```bash
# Verified static HTML contains expected schemas:
grep -o '"@type":"ItemList"' dist/index.html | wc -l    # Output: 1 âœ…
grep -o '"@type":"Product"' dist/index.html | wc -l     # Output: 4 âœ…
grep -o '"@type":"ItemList"' dist/rocafe/index.html | wc -l   # Output: 1 âœ…
grep -o '"@type":"Product"' dist/rocafe/index.html | wc -l    # Output: 75 âœ…
```

## ðŸš€ Deployment Considerations
- [x] No deployment changes needed (backward compatible)
- [x] Build process requires menu API access at build time
- [x] Graceful fallback if API unavailable: returns empty array, client-side React uses static fallback
- [x] Future-proof: When Services/Locations APIs go live, zero code changes needed
- [x] Branch safety check prevents accidental production deploys

**Build Requirements:**
- Menu API must be accessible at build time: `https://romamart.netlify.app/api/public-menu`
- If API unavailable: Build succeeds with warning, ProductList schemas skipped
- Services/Locations APIs currently return 404 (expected, not yet live)

## ðŸ”’ Security Considerations
- [x] No security implications (read-only API access at build time)
- [x] No secrets or API keys in code
- [x] Build-time API fetching is safe (no runtime exposure)
- [x] Graceful fallback prevents build failures from API issues

## â™¿ Accessibility Checklist
- [x] No UI changes (schema-only updates)
- [x] All accessibility requirements remain unchanged
- [x] No impact on user-facing components

## ðŸ“– Documentation
- [x] Code has comprehensive JSDoc comments
- [x] CHANGELOG.md updated with Unreleased section
- [x] STRUCTURED_DATA_MASTER_PLAN.md updated (Step 3.1)
- [x] API_MIGRATION_READINESS.md updated (Part 8)
- [x] Detailed analysis archived at docs/archive/PRERENDER_SYSTEMATIC_FIX_ANALYSIS.md
- [x] Cross-references between documents updated

**Documentation Highlights:**
- Step 3.1 in master plan: Consolidated API fetching, LocationList fix, fallback strategy
- Part 8 in API readiness: Static fallback removal (3-phase approach, stability requirements)
- Detailed analysis archived for historical reference (813 lines)

## ðŸ’­ Notes for Reviewers

**Key Achievements:**
1. **Fixed Critical SEO Issue:** ProductList schemas now detectable by validators
2. **Systematic Approach:** Established reusable pattern for all API-driven schemas
3. **Future-Proof:** Services/Locations APIs ready to go live with zero code changes
4. **Zero Runtime Impact:** Schemas in static HTML, no JavaScript execution needed
5. **Comprehensive Documentation:** 3-phase fallback removal strategy with clear requirements

**Design Decisions:**
- **Graceful Fallback:** Return empty arrays if APIs unavailable (not static imports)
  - Why: Client-side React already has static fallback via context providers
  - Why: Keeps prerender script clean, no ESM import issues
- **Parallel API Fetching:** Promise.all for maximum efficiency
  - Why: Build time matters, parallel is faster than sequential
  - Why: Single point of API fetching for maintainability
- **Homepage LocationList Fix:** Only primary location in schema
  - Why: Matches actual display logic in App.jsx
  - Why: Schema should reflect what users see on page
- **Static Fallback Strategy:** 3 phases with stability requirements
  - Why: Risk mitigation - don't remove fallbacks until APIs proven stable
  - Why: Menu Items API stable for 2+ months = reference implementation
  - Why: Services/Locations need same stability proof before fallback removal

**Pattern for Future APIs:**
```javascript
// Established pattern (1-2 hours per API):
async function fetchApiData() {
  const response = await fetch(API_URL);
  return response.ok ? (await response.json()).data : [];
}

const [menu, services, locations] = await Promise.all([
  fetchMenuData(),
  fetchServicesData(),
  fetchLocationsData()
]);

// Route-specific schema injection
if (routePath === '/' && menuItems.length > 0) {
  const schema = buildProductListSchema(menuItems, true); // featured only
  graph.push(schema);
}
```

## ðŸŽ¯ Review Focus Areas
- [x] Logic correctness (prerender API fetching, schema generation)
- [x] Performance impact (2-3 second build time increase acceptable)
- [ ] Security implications (build-time API access is secure)
- [ ] Code maintainability (pattern clear for future APIs)
- [x] Test coverage (manual verification of static HTML)
- [x] Documentation completeness (master plan, API readiness, changelog)

**Specific Areas for Review:**
1. **Prerender.js Logic:** Verify API fetching pattern is sound
2. **Schema Generation:** Verify ProductList schemas match React component logic
3. **LocationList Fix:** Confirm homepage primary-only logic is correct
4. **Documentation:** Verify fallback removal strategy makes sense
5. **Build Process:** Confirm graceful fallbacks work as expected

## ðŸ“Š Metrics & Verification

**Build Output:**
```
ðŸ“¡ Fetching API data for prerendering...
Fetching menu data from API for prerendering...
âœ“ Fetched 75 menu items (4 featured)
âœ“ API data fetching complete
Prerendering /...
  âœ“ c:\src\romamart.ca\dist\index.html
Prerendering /rocafe...
  âœ“ c:\src\romamart.ca\dist\rocafe\index.html
âœ“ Prerendering complete!
```

**Static HTML Validation:**
- Homepage: 1 ItemList + 4 Products = âœ… Matches expected
- RoCafÃ©: 1 ItemList + 75 Products = âœ… Matches expected
- Services API: 404 (expected, not live) â†’ Empty array â†’ Client fallback
- Locations API: 404 (expected, not live) â†’ Empty array â†’ Client fallback

**Commits (7 total):**
- `e0279b9` - feat(seo): prerender ProductList schemas
- `f5a47ec` - docs(seo): comprehensive prerender analysis (archived)
- `2b3dc70` - feat(build): consolidate API fetching
- `9823326` - fix(seo): correct LocationList homepage logic
- `5c0cefe` - docs(api): document static fallback removal strategy
- `e803f30` - docs: consolidate prerender analysis into master plan
- `f6156fa` - docs(changelog): add Unreleased section

**Effort Estimates for Future APIs:**
- Services API: 1-2 hours (pattern established)
- Locations API: 1-2 hours (pattern established)
- Company Data API: 3-4 hours (wider impact, see API_MIGRATION_READINESS.md Part 3)

---

_Thank you for reviewing! This PR establishes a systematic pattern for API-driven schemas that will save significant development time in future API migrations. ðŸŽ‰_
