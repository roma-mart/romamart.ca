import{r as h,j as s,C as b,N as w,x as N}from"./icons-CvXAfzdR.js";import{P as y}from"./index-COOfCQs0.js";class j{constructor(e={}){const{failureThreshold:n=5,resetAfterMs:l=3600*1e3,apiName:a="API"}=e;this.failureThreshold=n,this.resetAfterMs=l,this.apiName=a,this.failureCount=0,this.lastFailureTime=null,this.isOpen=!1}recordFailure(e){let n=e;if(e instanceof Error&&(n=e.status||e.statusCode),![429,403,402].includes(n))return!1;this.failureCount++,this.lastFailureTime=Date.now();const a=this.failureCount>=this.failureThreshold&&!this.isOpen;return a&&(this.isOpen=!0),a}shouldAttemptCall(){return this.isOpen?Date.now()-this.lastFailureTime>this.resetAfterMs?(this.isOpen=!1,this.failureCount=0,!0):!1:!0}getStatus(){const e=this.isOpen?Math.max(0,this.resetAfterMs-(Date.now()-this.lastFailureTime)):0;return{isOpen:this.isOpen,failureCount:this.failureCount,quotaExceeded:this.failureCount>=this.failureThreshold,timeUntilReset:e,apiName:this.apiName}}reset(){}}function v(r,e={}){return new j({failureThreshold:5,resetAfterMs:3600*1e3,apiName:r,...e})}const O={googlePlaces:v("Google Places API"),web3Forms:v("Web3Forms API")},C=parseInt(void 0,10),A=Number.isNaN(C)?3600*1e3:C,k=new Map;async function H(r){if(!r)throw new Error("Place ID is required");if(!O.googlePlaces.shouldAttemptCall())return null;throw new Error("Google Places API key not configured (VITE_GOOGLE_PLACES_API_KEY)")}function S(r){if(!r)return null;const e=r.regularOpeningHours||r.currentOpeningHours||r.opening_hours||r.openingHours;if(!e)return null;const n=e.weekdayDescriptions||e.weekday_text,l=e.openNow??e.open_now,a=e.periods;return{isOpenNow:l??!1,weekdayText:n||[],periods:a||[],display:P(n)}}function P(r){if(!r||r.length===0)return{weekdays:"Hours not available",weekends:"Hours not available",full:"Hours not available"};const e=r.map(t=>{const i=t.indexOf(": ");if(i===-1)return{day:t,hours:"Closed"};const f=t.substring(0,i),d=t.substring(i+2).trim()||"Closed";return{day:f,hours:d}});if(e.length!==7)return{weekdays:"Hours not available",weekends:"Hours not available",full:r,allSame:!1};const n=["Monday","Tuesday","Wednesday","Thursday","Friday"],l=e.filter(t=>n.includes(t.day)).map(t=>t.hours),a=["Saturday","Sunday"],c=e.filter(t=>a.includes(t.day)).map(t=>t.hours),p=l.length>0&&l.every(t=>t===l[0]),u=c.length>0&&c.every(t=>t===c[0]),o=e.length>0&&e.every(t=>t.hours===e[0].hours);return{weekdays:p&&l.length>0?l[0]:"Varies",weekends:u&&c.length>0?c[0]:"Varies",full:r,allSame:o}}function E(r,e={}){const{enabled:n=!0,cacheDuration:l=A}=e,[a,c]=h.useState(null),[p,u]=h.useState(!0),[o,t]=h.useState(null),[i,f]=h.useState(null),d=h.useCallback(async()=>{if(!r||!n){u(!1);return}const m=k.get(r);if(m&&Date.now()-m.timestamp<l){c(m.hours),f(m.isOpenNow),u(!1);return}u(!0),t(null);try{const g=await H(r);if(!g){u(!1);return}const x=S(g);if(!x){u(!1);return}k.set(r,{hours:x,isOpenNow:x?.isOpenNow,timestamp:Date.now()}),c(x),f(x?.isOpenNow)}catch(g){t(g.message)}finally{u(!1)}},[r,n,l]);return h.useEffect(()=>{d()},[d]),{hours:a,isLoading:p,error:o,refetch:d,isOpenNow:i}}function M({placeId:r,fallbackHours:e,showStatus:n=!0,compact:l=!1}){const{hours:a,isLoading:c,error:p,refetch:u,isOpenNow:o}=E(r),t=h.useMemo(()=>({color:"var(--color-icon)"}),[]),i=h.useMemo(()=>a?.display||{weekdays:e?.weekdays||"Hours not available",weekends:e?.weekends||"Hours not available",full:null},[a?.display,e?.weekdays,e?.weekends]),f=h.useCallback(()=>{if(p)return s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2",style:{color:"var(--color-text-muted)"},children:[s.jsx(b,{size:16}),s.jsx("span",{className:"text-sm",children:"Unable to load live hours"})]}),s.jsxs("p",{className:"font-inter",style:{color:"var(--color-text-muted)"},children:["Mon-Fri: ",e?.weekdays]}),s.jsxs("p",{className:"font-inter",style:{color:"var(--color-text-muted)"},children:["Sat-Sun: ",e?.weekends]})]});if(c)return s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex items-center gap-2",style:{color:"var(--color-text-muted)"},children:[s.jsx(w,{size:16,className:"animate-spin"}),s.jsx("span",{className:"text-sm",children:"Loading hours..."})]}),s.jsxs("p",{className:"font-inter",style:{color:"var(--color-text-muted)"},children:["Mon-Fri: ",e?.weekdays]}),s.jsxs("p",{className:"font-inter",style:{color:"var(--color-text-muted)"},children:["Sat-Sun: ",e?.weekends]})]});if(i.allSame&&Array.isArray(i.full)&&i.full.length>0){const d=i.full[0],m=typeof d=="string"&&d.includes(": ")?d.split(": ")[1]:null;if(m)return s.jsxs("div",{className:"space-y-1",children:[n&&o!==null&&s.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-semibold mb-1",style:{backgroundColor:o?"var(--color-success-bg)":"var(--color-error-bg)",color:o?"var(--color-success)":"var(--color-error)"},role:"status","aria-label":o?"Currently open":"Currently closed",children:[s.jsx("span",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:o?"var(--color-success)":"var(--color-error)",display:"inline-block"},"aria-hidden":"true"}),o?"Open Now":"Closed"]}),s.jsxs("p",{className:"font-inter font-semibold",style:{color:"var(--color-text)"},children:["Open Daily: ",m]})]})}return s.jsxs("div",{className:"space-y-1",children:[n&&o!==null&&s.jsxs("span",{className:"inline-flex items-center gap-1.5 px-2 py-0.5 rounded-full text-xs font-semibold mb-1",style:{backgroundColor:o?"var(--color-success-bg)":"var(--color-error-bg)",color:o?"var(--color-success)":"var(--color-error)"},role:"status","aria-label":o?"Currently open":"Currently closed",children:[s.jsx("span",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:o?"var(--color-success)":"var(--color-error)",display:"inline-block"},"aria-hidden":"true"}),o?"Open Now":"Closed"]}),s.jsxs("p",{className:"font-inter",style:{color:"var(--color-text-muted)"},children:["Mon-Fri: ",i.weekdays]}),s.jsxs("p",{className:"font-inter",style:{color:"var(--color-text-muted)"},children:["Sat-Sun: ",i.weekends]})]})},[p,c,i,n,o,e]);return l?s.jsxs("div",{className:"flex items-start gap-2",children:[s.jsx(N,{size:18,style:t,className:"flex-shrink-0 mt-0.5"}),s.jsx("div",{className:"flex-1",children:f()})]}):s.jsxs("div",{className:"flex gap-4",children:[s.jsx(N,{size:24,style:t,className:"flex-shrink-0 mt-1"}),s.jsxs("div",{className:"flex-1",children:[s.jsx("h3",{className:"font-bold mb-1",style:{color:"var(--color-text)"},children:"Hours"}),f(),(a||p)&&s.jsxs("button",{onClick:u,className:"mt-2 text-xs hover:underline flex items-center gap-1",style:{color:"var(--color-accent)"},"aria-label":"Refresh hours",children:[s.jsx(w,{size:12}),"Refresh"]})]})]})}M.propTypes={placeId:y.string.isRequired,fallbackHours:y.shape({weekdays:y.string,weekends:y.string,display:y.string}),showStatus:y.bool,compact:y.bool};export{M as L};
